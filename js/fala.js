
(function(){const form=document.getElementById('submit-form');const dz=document.getElementById('dropzone');const input=dz?.querySelector('input[type=file]')||form?.querySelector('input[name=foto]');const pick=document.getElementById('pick');const preview=document.getElementById('preview');const exportBtn=document.getElementById('export-submissions');function showPreview(file){const r=new FileReader();r.onload=()=>{preview.src=r.result;preview.hidden=false;};r.readAsDataURL(file);}pick?.addEventListener('click',()=>input?.click());dz?.addEventListener('dragover',e=>{e.preventDefault();dz.style.borderColor='var(--accent2)';});dz?.addEventListener('dragleave',e=>{dz.style.borderColor='';});dz?.addEventListener('drop',e=>{e.preventDefault();input.files=e.dataTransfer.files;if(input.files[0])showPreview(input.files[0]);});input?.addEventListener('change',e=>{if(input.files[0])showPreview(input.files[0]);});form?.addEventListener('submit',async e=>{e.preventDefault();const fd=new FormData(form);let base64=null;const file=fd.get('foto');if(file&&file.size>0)base64=await new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(file);});const payload={autor:fd.get('autor'),email:fd.get('email'),titulo:fd.get('titulo'),texto:fd.get('texto'),foto_base64:base64,created_at:new Date().toISOString()};const key='cosprysma_submissions';const list=JSON.parse(localStorage.getItem(key)||'[]');list.push(payload);localStorage.setItem(key,JSON.stringify(list));document.getElementById('submit-success').hidden=false;form.reset();preview.hidden=true;});exportBtn?.addEventListener('click',()=>{const key='cosprysma_submissions';const data=localStorage.getItem(key)||'[]';const blob=new Blob([data],{type:'application/json'});const url=URL.createObjectURL(blob);const a=Object.assign(document.createElement('a'),{href:url,download:'submissions.json'});document.body.appendChild(a);a.click();URL.revokeObjectURL(url);a.remove();});})();
